<?php

// Generate random 4-digit code
$randomCode = str_pad(rand(0, 9999), 4, '0', STR_PAD_LEFT);

$_SESSION['sms'] = $randomCode;

$text = "Vulnerability Scanner: Your one time passcode is " . $randomCode;

$apiKey = 'KEY0183A35D1B31B171BD78EEB8369C7C2C_qb0q4m7QwIiPrL4R7KIiix';
$url = 'https://api.telnyx.com/v2/messages';
$data = json_encode([
    'from' => '+447418620546',
    'to' => '+447849291993',
    'text' => $randomCode
]);
$options = [
    'http' => [
        'method' => 'POST',
        'header' => implode("\r\n", [
            'Content-Type: application/json',
            'Authorization: Bearer ' . $apiKey
        ]),
        'content' => $data
    ]
];
$response = file_get_contents($url, false, stream_context_create($options));

//uncomment this for testing eg no more credit on account
//echo $response;

?>