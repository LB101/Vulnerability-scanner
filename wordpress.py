import re
import requests
from bs4 import BeautifulSoup
import sys

def detect_wordpress_version(url):
    try:
        response = requests.get(url)
        if response.status_code == 200:
            soup = BeautifulSoup(response.text, 'html.parser')
            version_tag = soup.find('meta', attrs={'name': 'generator', 'content': re.compile(r'WordPress (.*)')})
            if version_tag:
                version = version_tag['content'].split('WordPress ')[1]
                print("WordPress version:", version)
            else:
                print("WordPress version not found.")
        else:
            print("Failed to retrieve page:", response.status_code)
    except Exception as e:
        print("An error occurred:", e)

def detect_wordpress_plugins(url):
    try:
        response = requests.get(url)
        if response.status_code == 200:
            soup = BeautifulSoup(response.text, 'html.parser')
            plugin_tags = soup.find_all('link', rel='stylesheet', href=lambda x: 'plugins' in x)
            plugins = [tag['href'].split('plugins/')[1].split('/')[0] for tag in plugin_tags]
            if plugins:
                print("WordPress plugins detected:", plugins)
            else:
                print("No WordPress plugins detected.")
        else:
            print("Failed to retrieve page:", response.status_code)
    except Exception as e:
        print("An error occurred:", e)



url =  sys.argv[1] # passing value from php

# url = "https://www.nginx.com/" for testing
detect_wordpress_version(url)
detect_wordpress_plugins(url)
