<?php
session_start();

$_SESSION['adminusr'] = $_POST["adminusr"];
$_SESSION['adminpass'] = $_POST["adminpass"];

if($_SESSION['adminusr'] != "admin" || $_SESSION['adminpass'] != "admin")
{


    header("Location: adminlogin.php");
}

$_SESSION['isLoggedInAdmin'] = true;
include "conndb.php";

// Fetch all users from the database
$query = "SELECT * FROM users";
$result = mysqli_query($conn, $query);

// Start the HTML document
echo "<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        a {
            display: inline-block;
            margin-right: 10px;
            padding: 5px 10px;
            text-decoration: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 3px;
        }
    </style>
</head>
<body>"

;

if ($result) {
    echo "    <header>
        
    <h1 style='text-align: center;'>Admin</h1>
    <a href='admin_tickets.php'>Tickets</a>
    
</header>";
    // Display user data in a table
    echo "<table>
            <tr>
                <th>ID</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>";

    while ($row = mysqli_fetch_assoc($result)) {
        echo "<tr>
                <td>{$row['id']}</td>
                <td>{$row['firstname']}</td>
                <td>{$row['lastname']}</td>
                <td>{$row['email']}</td>
                <td>
                <button  class='button' onclick='deleteUser({$row['id']})'>Delete</button>
                
                </td>
              </tr>";
    }

    echo "</table>";

    // Free the result set
    mysqli_free_result($result);
} else {
    echo "Error: " . $query . "<br>" . mysqli_error($conn);
}

// Close the database connection
mysqli_close($conn);

// End the HTML document
echo "</body>
</html>";
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Scanner</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="icon" type="image/x-icon" href="logo.svg">
    <style>
     

        

        nav {
           
            padding: 10px;
            text-align: center;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 14px 16px;
            display: inline-block;
        }

        nav a:hover {
            
            color: rgb(255, 251, 0);
        }

        section {
            padding: 20px;
        }

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: #f2f2f2;
            /* Set background image */
            background-image: url('background.png');
            
            /* Set background size to cover the entire viewport */
            background-size: cover;

            /* Set background repeat to no-repeat */
            background-repeat: no-repeat;

            /* Set background position to center center */
            background-position: center center;

            /* Set minimum height to cover the entire viewport */
            min-height: 100vh;

            /* Optional: Add additional styles like background color */
            /* background-color: #f0f0f0; */
            
            /* Optional: Add styles to the content for better readability */
            /* color: #333; */
            /* font-family: Arial, sans-serif; */
            /* other styles... */

        }

         
        .login {

    background-color: #3498db; /* Blue background color */
    color: white;
    text-decoration: none;
    padding: 12px 18px; /* Adjust padding as needed */
    display: inline-block;
    border-radius: 5px; /* Rounded edges */
    margin-left: 1%;

        }


        .reg{
            border: 2px solid white; 
    border-radius: 10px;
    padding: 10px 16px; /* Adjust padding as needed */
    display: inline-block;

        }


        input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #3498db;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
    color: rgb(255, 251, 0);
}

div {
  border-radius: 5px;
  /* background-color: #f2f2f2; */
  
  width: 50%;
  position: absolute;
  
  left: 25%;


}

.info{

    position:relative; top:120px;
}

.button {

    font-family: 'Roboto', sans-serif;
    border-collapse: collapse;
    text-align: left;
    display: inline-block;
    margin-right: 10px;
    padding: 5px 10px;
    text-decoration: none;
    background-color: red;
    color: white;
    border-radius: 3px;
    cursor: pointer;

}

th {
background-color:#3498db;
    
}

    </style>
</head>
<body >



   

   
    

    <script>
    
    function Delete() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
     var response = this.responseText;
     

     if (response == "true") {
                        // User is logged in, proceed with form submission
                        var searchForm = document.getElementById("form");
                        searchForm.submit();
                    } else {
                        alert("you need to be logged in to perform this action");
                    }

    }
  };
  xhttp.open("post", "delete_user.php", true);
  xhttp.send();
}    
    

    // Function to handle AJAX request for deleting a user
    function deleteUser(userId) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'delete_user.php');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            if (xhr.status === 200) {
                // Handle success response, if needed
                alert('User deleted successfully!');
                // Reload the page or update the UI as required
                location.reload(); // Reload the page for example
            } else {
                // Handle error response
                alert('Error deleting user: ' + xhr.statusText);
            }
        };
        xhr.onerror = function() {
            // Handle network errors
            alert('Network error occurred while deleting user');
        };
        xhr.send('id=' + userId);
    }
    </script>
</body>
</html>
